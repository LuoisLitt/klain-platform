<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Äî Dura Fulfilment</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Self-hosted fonts (GDPR compliant) */
        @font-face {
            font-family: 'DM Sans';
            font-style: normal;
            font-weight: 300 700;
            font-display: swap;
            src: url('../fonts/dm-sans-latin.woff2') format('woff2');
        }
        @font-face {
            font-family: 'Fraunces';
            font-style: normal;
            font-weight: 400 700;
            font-display: swap;
            src: url('../fonts/fraunces-latin.woff2') format('woff2');
        }
        @font-face {
            font-family: 'Fraunces';
            font-style: italic;
            font-weight: 400;
            font-display: swap;
            src: url('../fonts/fraunces-italic-latin.woff2') format('woff2');
        }
    </style>
    <style>
        :root {
            --black: #0f1117;
            --gray-dark: #6b7084;
            --gray-medium: #8e93a6;
            --gray-light: #f7f8fa;
            --gray-100: #eef0f5;
            --white: #ffffff;
            --blue: #2563eb;
            --blue-hover: #1d4ed8;
            --blue-light: #eff6ff;
            --blue-muted: #dbeafe;
            --green: #16a34a;
            --green-light: #f0fdf4;
            --orange: #ea580c;
            --orange-light: #fff7ed;
            --red: #dc2626;
            --red-light: #fef2f2;
            --purple: #7c3aed;
            --purple-light: #f5f3ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-light);
            color: var(--black);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 32px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 48px;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .logo span {
            color: var(--blue);
        }

        .nav-links {
            display: flex;
            gap: 32px;
            list-style: none;
        }

        .nav-links a {
            color: var(--gray-dark);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--black);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: 600;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        /* Main Content */
        .main {
            padding: 88px 32px 48px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
        }

        .header-title h1 {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 4px;
        }

        .header-title p {
            color: var(--gray-dark);
            font-size: 15px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--black);
            border: 1px solid #d2d2d7;
        }

        .btn-secondary:hover {
            background: var(--gray-light);
        }

        .btn-primary {
            background: var(--blue);
            color: var(--white);
            border: none;
        }

        .btn-primary:hover {
            background: var(--blue-hover);
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        /* AI Briefing Hero */
        .ai-briefing {
            display: flex;
            gap: 20px;
            background: linear-gradient(135deg, var(--blue-light) 0%, #f0f4ff 100%);
            border: 1px solid rgba(37, 99, 235, 0.1);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 32px;
        }

        .ai-briefing-icon {
            width: 56px;
            height: 56px;
            background: var(--blue);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .ai-briefing-icon svg {
            width: 28px;
            height: 28px;
            stroke: white;
        }

        .ai-briefing-content {
            flex: 1;
        }

        .ai-briefing-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .ai-briefing-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            background: var(--blue);
            color: white;
            font-size: 11px;
            font-weight: 600;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ai-briefing-time {
            font-size: 13px;
            color: var(--gray-dark);
        }

        .ai-briefing-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 8px;
        }

        .ai-briefing-text {
            font-size: 15px;
            color: var(--gray-dark);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .ai-briefing-text strong {
            color: var(--black);
            font-weight: 600;
        }

        .ai-briefing-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ai-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
        }

        .ai-action.warning {
            background: var(--orange-light);
            color: var(--orange);
        }

        .ai-action.info {
            background: var(--blue-muted);
            color: var(--blue);
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .kpi-card {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .kpi-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .kpi-icon.blue { background: var(--blue-light); }
        .kpi-icon.blue svg { stroke: var(--blue); }
        .kpi-icon.green { background: var(--green-light); }
        .kpi-icon.green svg { stroke: var(--green); }
        .kpi-icon.orange { background: var(--orange-light); }
        .kpi-icon.orange svg { stroke: var(--orange); }
        .kpi-icon.red { background: var(--red-light); }
        .kpi-icon.red svg { stroke: var(--red); }
        .kpi-icon.purple { background: var(--purple-light); }
        .kpi-icon.purple svg { stroke: var(--purple); }

        .kpi-icon svg {
            width: 20px;
            height: 20px;
        }

        .kpi-trend {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .kpi-trend.up {
            background: var(--green-light);
            color: var(--green);
        }

        .kpi-trend.down {
            background: var(--red-light);
            color: var(--red);
        }

        .kpi-trend svg {
            width: 12px;
            height: 12px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 4px;
        }

        .kpi-label {
            font-size: 14px;
            color: var(--gray-dark);
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 17px;
            font-weight: 600;
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--gray-medium);
            margin-top: 2px;
        }

        .card-link {
            font-size: 14px;
            color: var(--blue);
            text-decoration: none;
            font-weight: 500;
        }

        .card-link:hover {
            text-decoration: underline;
        }

        /* Chart */
        .chart-container {
            height: 280px;
            position: relative;
        }

        /* Carrier List */
        .carrier-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .carrier-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--gray-light);
            border-radius: 12px;
        }

        .carrier-logo {
            width: 44px;
            height: 44px;
            background: var(--white);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 11px;
            color: var(--gray-dark);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .carrier-info {
            flex: 1;
        }

        .carrier-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .carrier-stats {
            font-size: 13px;
            color: var(--gray-medium);
        }

        .carrier-bar {
            width: 80px;
            height: 6px;
            background: #e8e8ed;
            border-radius: 3px;
            overflow: hidden;
        }

        .carrier-bar-fill {
            height: 100%;
            background: var(--green);
            border-radius: 3px;
        }

        .carrier-percent {
            font-size: 15px;
            font-weight: 700;
            color: var(--green);
            width: 52px;
            text-align: right;
        }

        /* Orders Table */
        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }

        .orders-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-medium);
            border-bottom: 1px solid #e8e8ed;
        }

        .orders-table td {
            padding: 16px;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f2;
        }

        .orders-table tr:last-child td {
            border-bottom: none;
        }

        .order-id {
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-weight: 600;
            color: var(--blue);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .status-badge.shipped {
            background: var(--green-light);
            color: var(--green);
        }

        .status-badge.processing {
            background: var(--blue-light);
            color: var(--blue);
        }

        .status-badge.pending {
            background: var(--orange-light);
            color: var(--orange);
        }

        .status-badge.delivered {
            background: #f3e8ff;
            color: var(--purple);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        /* Alerts */
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 12px;
        }

        .alert-item.critical {
            background: var(--red-light);
        }

        .alert-item.warning {
            background: var(--orange-light);
        }

        .alert-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .alert-item.critical .alert-icon {
            background: rgba(255, 59, 48, 0.15);
        }

        .alert-item.warning .alert-icon {
            background: rgba(255, 149, 0, 0.15);
        }

        .alert-icon svg {
            width: 16px;
            height: 16px;
        }

        .alert-item.critical .alert-icon svg { stroke: var(--red); }
        .alert-item.warning .alert-icon svg { stroke: var(--orange); }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 2px;
        }

        .alert-subtitle {
            font-size: 13px;
            color: var(--gray-dark);
        }

        .alert-count {
            font-size: 18px;
            font-weight: 700;
        }

        .alert-item.critical .alert-count { color: var(--red); }
        .alert-item.warning .alert-count { color: var(--orange); }

        /* AI Insight */
        .ai-insight {
            margin-top: 20px;
            padding: 20px;
            background: var(--blue-light);
            border-radius: 12px;
        }

        .ai-insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .ai-insight-icon {
            width: 28px;
            height: 28px;
            background: var(--blue);
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-insight-icon svg {
            width: 14px;
            height: 14px;
            stroke: white;
        }

        .ai-insight-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--blue);
        }

        .ai-insight-text {
            font-size: 14px;
            color: var(--black);
            line-height: 1.6;
        }

        .ai-insight-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            font-size: 14px;
            font-weight: 600;
            color: var(--blue);
            cursor: pointer;
        }

        .ai-insight-action svg {
            width: 14px;
            height: 14px;
        }

        /* Mobile Hamburger */
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 8px;
            background: none;
            border: none;
        }

        .hamburger span {
            width: 20px;
            height: 2px;
            background: var(--black);
            border-radius: 1px;
            transition: transform 0.3s, opacity 0.3s;
        }

        .hamburger.active span:nth-child(1) {
            transform: translateY(7px) rotate(45deg);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: translateY(-7px) rotate(-45deg);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .kpi-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 56px;
                left: 0;
                right: 0;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: saturate(180%) blur(20px);
                -webkit-backdrop-filter: saturate(180%) blur(20px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.08);
                flex-direction: column;
                padding: 16px 32px;
                gap: 4px;
                z-index: 999;
            }

            .nav-links.mobile-open {
                display: flex;
            }

            .nav-links a {
                display: block;
                padding: 10px 0;
                font-size: 15px;
            }

            .global-search,
            .btn-warehouse,
            .nav-user {
                display: none;
            }

            .main {
                padding: 80px 16px 32px;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 16px;
            }

            .header-actions {
                width: 100%;
            }

            .header-actions .btn {
                flex: 1;
                justify-content: center;
            }

            .orders-table {
                font-size: 13px;
            }

            .orders-table th,
            .orders-table td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <script src="auth.js"></script>
    <!-- Navigation -->
    <nav>
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html" class="logo">Dura <span>Fulfilment</span></a>
                <ul class="nav-links">
                    <li><a href="index.html" class="active">Dashboard</a></li>
                    <li><a href="orders.html">Orders</a></li>
                    <li><a href="voorraad.html">Voorraad</a></li>
                    <li><a href="verzendingen.html">Verzendingen</a></li>
                    <li><a href="rapportages.html">Rapportages</a></li>
                </ul>
            </div>
            <div class="nav-right">
                <div class="global-search" style="position:relative;">
                    <input type="text" id="globalSearch" placeholder="Zoek order, klant, SKU..." 
                        style="width:220px;padding:8px 12px 8px 34px;border:1px solid #d2d2d7;border-radius:8px;font-size:13px;font-family:inherit;background:var(--gray-light);outline:none;transition:all 0.2s;"
                        onfocus="this.style.width='300px';this.style.borderColor='var(--blue)';this.style.background='#fff'"
                        onblur="this.style.width='220px';this.style.borderColor='#d2d2d7';this.style.background='var(--gray-light)'"
                        onkeydown="if(event.key==='Enter')doGlobalSearch()">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:#8e93a6;pointer-events:none;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                    </svg>
                </div>
                <a href="warehouse.html" class="btn-warehouse" title="Warehouse Display" style="display: flex; align-items: center; gap: 8px; padding: 8px 14px; background: var(--blue-light); color: var(--blue); border-radius: 8px; font-size: 13px; font-weight: 500; text-decoration: none;">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 20.25h12m-7.5-3v3m3-3v3m-10.125-3h17.25c.621 0 1.125-.504 1.125-1.125V4.875c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125z" />
                    </svg>
                    Warehouse Display
                </a>
                <div class="nav-user">
                    <div class="user-avatar" id="userAvatar">DF</div>
                    <span class="user-name" id="userName">Demo Account</span>
                </div>
                <button class="hamburger" aria-label="Menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <h1>Dashboard</h1>
                <p>Live data uit Goedgepickt ‚Äî Laden...</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                    </svg>
                    Week 6
                </button>
                <button class="btn btn-primary">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    Exporteer
                </button>
            </div>
        </header>

        <!-- AI Briefing Hero Card -->
        <div class="ai-briefing">
            <div class="ai-briefing-icon">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                </svg>
            </div>
            <div class="ai-briefing-content">
                <div class="ai-briefing-header">
                    <span class="ai-briefing-badge">AI Briefing</span>
                    <span class="ai-briefing-time">Vandaag 07:00</span>
                </div>
                <h3 class="ai-briefing-title">Laden...</h3>
                <p class="ai-briefing-text">
                    Samenvatting wordt geladen vanuit Goedgepickt...
                </p>
                <div class="ai-briefing-actions">
                    <span class="ai-action info">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 14px; height: 14px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>
                        Data wordt elke minuut ververst
                    </span>
                </div>
            </div>
        </div>

        <!-- Auto-refresh indicator -->
        <div id="refreshIndicator" style="display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:13px;color:var(--gray-dark);transition:opacity 0.3s;">
            <span style="display:inline-block;width:8px;height:8px;background:var(--green);border-radius:50%;"></span>
            Laatste update: <span id="lastUpdateTime">‚Äî</span>
            <span id="refreshFlash" style="color:var(--blue);font-weight:500;opacity:0;transition:opacity 0.5s;">‚úì Ververst</span>
        </div>

        <!-- KPI Grid -->
        <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon blue">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                        </svg>
                    </div>
                    <span class="kpi-trend" id="kpiOrdersWeekTrend" style="display:none;"></span>
                </div>
                <div class="kpi-value" id="kpiOrdersWeek">‚Äî</div>
                <div class="kpi-label" title="Totaal aantal orders binnengekomen in Goedgepickt deze week">Orders deze week</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon green">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
                <div class="kpi-value" id="kpiOrdersToday">‚Äî</div>
                <div class="kpi-label" title="Aantal ontvangen orders in Goedgepickt vandaag">Orders vandaag</div>
            </div>

            <!-- Omzet vandaag -->
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon green" style="background:#f0fdf4;">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" style="stroke:var(--green);">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                        </svg>
                    </div>
                </div>
                <div class="kpi-value" id="kpiRevenueToday" style="font-size:28px;">‚Äî</div>
                <div class="kpi-label">Omzet vandaag</div>
            </div>

            <!-- Omzet week -->
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon blue">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                        </svg>
                    </div>
                </div>
                <div class="kpi-value" id="kpiRevenueWeek" style="font-size:28px;">‚Äî</div>
                <div class="kpi-label">Omzet deze week</div>
            </div>
        </div>

        <!-- Second KPI row -->
        <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr); margin-top:-12px;">
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon blue">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
                        </svg>
                    </div>
                    <span class="kpi-trend" id="kpiShipWeekTrend" style="display:none;"></span>
                </div>
                <div class="kpi-value" id="kpiShipmentsWeek">‚Äî</div>
                <div class="kpi-label" title="Verzendingen deze week">Verzendingen week</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon orange">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
                <div class="kpi-value" id="kpiProcessingTime">‚Äî</div>
                <div class="kpi-label">Gem. verwerkingstijd</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon green">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                        </svg>
                    </div>
                </div>
                <div class="kpi-value" id="kpiOpenOrders">‚Äî</div>
                <div class="kpi-label">Open orders</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon green">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
                <div class="kpi-value" id="kpiProcessedOrders">‚Äî</div>
                <div class="kpi-label" title="Orders met status shipped, completed, of delivered vandaag">Verwerkte orders</div>
            </div>
        </div>

        <!-- SLA Metrics -->
        <div style="margin-bottom:24px;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <h2 style="font-size:18px;font-weight:600;">SLA Metrics</h2>
                    <span id="slaStatus" style="font-size:12px;color:var(--gray-dark);"></span>
                </div>
                <div id="slaPeriodBtns" style="display:flex;gap:4px;">
                    <button class="sla-period-btn active" data-period="today" style="padding:6px 14px;border-radius:8px;border:1px solid #e5e7eb;background:var(--blue);color:white;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;">Vandaag</button>
                    <button class="sla-period-btn" data-period="week" style="padding:6px 14px;border-radius:8px;border:1px solid #e5e7eb;background:white;color:var(--gray-dark);font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;">Week</button>
                    <button class="sla-period-btn" data-period="month" style="padding:6px 14px;border-radius:8px;border:1px solid #e5e7eb;background:white;color:var(--gray-dark);font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;">Maand</button>
                </div>
            </div>
            <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr);">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon green">
                            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <span class="kpi-trend" id="slaOnTimeTrend" style="display:none;"></span>
                    </div>
                    <div class="kpi-value" id="slaOnTime" style="font-size:28px;">‚Äî</div>
                    <div class="kpi-label" title="Percentage orders verzonden binnen 24 uur SLA">On-Time Shipping</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon blue">
                            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <span class="kpi-trend" id="slaAccuracyTrend" style="display:none;"></span>
                    </div>
                    <div class="kpi-value" id="slaAccuracy" style="font-size:28px;">‚Äî</div>
                    <div class="kpi-label" title="Percentage orders zonder aandachtspunten">Order Accuracy</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon orange">
                            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                            </svg>
                        </div>
                        <span class="kpi-trend" id="slaCycleTrend" style="display:none;"></span>
                    </div>
                    <div class="kpi-value" id="slaCycleTime" style="font-size:28px;">‚Äî</div>
                    <div class="kpi-label" title="Gemiddelde doorlooptijd van order tot verzending">Doorlooptijd</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon purple">
                            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                            </svg>
                        </div>
                        <span class="kpi-trend" id="slaPerfectTrend" style="display:none;"></span>
                    </div>
                    <div class="kpi-value" id="slaPerfect" style="font-size:28px;">‚Äî</div>
                    <div class="kpi-label" title="Orders die on-time, accuraat en volledig afgerond zijn">Perfect Order Rate</div>
                </div>
            </div>
        </div>

        <!-- Probleem Orders Alert -->
        <div id="problemAlert" style="display:none;background:var(--red-light);border:1px solid rgba(220,38,38,0.2);border-radius:16px;padding:20px 24px;margin-bottom:24px;display:none;">
            <div style="display:flex;align-items:center;gap:16px;">
                <div style="width:44px;height:44px;background:rgba(220,38,38,0.15);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="var(--red)" style="width:24px;height:24px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                </div>
                <div style="flex:1;">
                    <div style="font-size:16px;font-weight:600;color:var(--red);margin-bottom:2px;">‚ö†Ô∏è <span id="problemCount">0</span> probleem-orders</div>
                    <div style="font-size:14px;color:#991b1b;">Orders die aandacht nodig hebben of langer dan 4 uur open staan</div>
                </div>
                <a href="orders.html" style="padding:10px 20px;background:var(--red);color:white;border-radius:10px;text-decoration:none;font-size:14px;font-weight:500;">Bekijk orders ‚Üí</a>
            </div>
        </div>

        <!-- Order Pipeline -->
        <div class="card" style="margin-bottom:24px;" id="pipelineCard">
            <div class="card-header">
                <div>
                    <div class="card-title">Order Pipeline</div>
                    <div class="card-subtitle">Verdeling per verwerkingsfase vandaag</div>
                </div>
            </div>
            <div id="pipelineContainer" style="display:flex;gap:4px;align-items:stretch;min-height:80px;">
                <div style="text-align:center;padding:20px;color:#999;width:100%;">Laden...</div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Orders per dag</div>
                        <div class="card-subtitle">Afgelopen 7 dagen</div>
                    </div>
                    <a href="voorraad.html" class="card-link">Bekijk alles</a>
                </div>
                <div class="chart-container">
                    <canvas id="ordersChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Carrier Verdeling</div>
                        <div class="card-subtitle">Aandeel per vervoerder</div>
                    </div>
                </div>
                <div class="carrier-list" id="carrierList">
                    <div style="text-align:center;padding:20px;color:#999;">Laden...</div>
                </div>
                <div id="carrierDisclaimer" style="display:none;margin-top:12px;padding:10px 14px;background:#fffbeb;border-radius:8px;border:1px solid #fde68a;font-size:12px;color:#92400e;">
                    ‚ö†Ô∏è Gebaseerd op de laatste 50 verzendingen. Grotere sample geeft nauwkeuriger beeld.
                </div>
            </div>
        </div>

        <!-- Second Row -->
        <div class="content-grid" style="grid-template-columns: 2fr 1fr 1fr;">
            <!-- Top 5 Webshops -->
            <div class="card" id="topWebshopsCard" style="grid-column:3;grid-row:1/3;">
                <div class="card-header">
                    <div>
                        <div class="card-title">üèÜ Top Webshops</div>
                        <div class="card-subtitle">Vandaag op ordervolume</div>
                    </div>
                </div>
                <div id="topWebshopsList" style="display:flex;flex-direction:column;gap:8px;">
                    <div style="text-align:center;padding:20px;color:#999;">Laden...</div>
                </div>
            </div>
            <div class="card" style="grid-column:1/3;">
                <div class="card-header">
                    <div>
                        <div class="card-title">Recente Orders</div>
                        <div class="card-subtitle">Laatste 5 orders</div>
                    </div>
                    <a href="orders.html" class="card-link">Alle orders</a>
                </div>
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Klant</th>
                            <th>Artikelen</th>
                            <th>Status</th>
                            <th>Carrier</th>
                        </tr>
                    </thead>
                    <tbody id="recentOrdersBody"><tr><td colspan="5" style="text-align:center;padding:30px;color:#999;">Laden...</td></tr></tbody>
                </table>
            </div>

            <div class="card" style="grid-column:1/3;">
                <div class="card-header">
                    <div>
                        <div class="card-title">Voorraad Alerts</div>
                        <div class="card-subtitle">Actie vereist</div>
                    </div>
                </div>

                <div class="alerts-list" id="alertsList">
                    <div style="text-align:center;padding:20px;color:#999;">Laden...</div>
                </div>

                <!-- AI Insight -->
                <div class="ai-insight">
                    <div class="ai-insight-header">
                        <div class="ai-insight-icon">
                            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                            </svg>
                        </div>
                        <span class="ai-insight-label">AI-inzicht</span>
                    </div>
                    <p class="ai-insight-text">
                        AI-inzichten worden geladen op basis van actuele data...
                    </p>
                    <div class="ai-insight-action">
                        Bestelling voorbereiden
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ============================================
        // LIVE API INTEGRATION ‚Äî Alle data uit Goedgepickt
        // ============================================
        const API_BASE = window.DURA_API_BASE;
        const API_HEADERS = window.DURA_API_HEADERS;

        const STATUS_MAP = {
            'open': 'Nieuw',
            'processing': 'In verwerking',
            'picked': 'Gepickt',
            'packed': 'Ingepakt',
            'shipped': 'Verzonden',
            'completed': 'Afgerond',
            'delivered': 'Afgeleverd'
        };

        const STATUS_CLASS_MAP = {
            'open': 'pending',
            'processing': 'processing',
            'picked': 'processing',
            'packed': 'processing',
            'shipped': 'shipped',
            'completed': 'delivered',
            'delivered': 'delivered'
        };

        function extractCarrier(obj) {
            const method = (obj.shippingMethod || obj.shippingCarrier || obj.shippingProvider || '').toUpperCase();
            if (method.includes('DHL')) return 'DHL';
            if (method.includes('POSTNL') || method.includes('POST NL') || method.includes('MYPARCEL')) return 'PostNL';
            if (method.includes('TNT')) return 'TNT';
            if (method.includes('DPD')) return 'DPD';
            if (method.includes('UPS')) return 'UPS';
            return method.split(' ').slice(0, 2).join(' ') || '‚Äî';
        }

        function formatDutchDate(dateStr) {
            if (!dateStr) return '‚Äî';
            const d = new Date(dateStr);
            const now = new Date();
            const isToday = d.toDateString() === now.toDateString();
            const yesterday = new Date(now); yesterday.setDate(now.getDate() - 1);
            const isYesterday = d.toDateString() === yesterday.toDateString();
            const hh = String(d.getHours()).padStart(2, '0');
            const mm = String(d.getMinutes()).padStart(2, '0');
            if (isToday) return `Vandaag, ${hh}:${mm}`;
            if (isYesterday) return `Gisteren, ${hh}:${mm}`;
            const dag = d.getDate();
            const maanden = ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'];
            return `${dag} ${maanden[d.getMonth()]}, ${hh}:${mm}`;
        }

        // ============ GLOBAL SEARCH ============
        function doGlobalSearch() {
            const q = document.getElementById('globalSearch').value.trim();
            if (q) window.location.href = 'orders.html?search=' + encodeURIComponent(q);
        }

        // ============ FORMAT HELPERS ============
        function formatEuro(amount) {
            return '‚Ç¨' + Number(amount).toLocaleString('nl-NL', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatProcessingTime(minutes) {
            if (!minutes || minutes <= 0) return '‚Äî';
            if (minutes < 60) return Math.round(minutes) + ' min';
            const h = Math.floor(minutes / 60);
            const m = Math.round(minutes % 60);
            return h + 'u ' + m + 'm';
        }

        function renderWeekTrend(el, current, previous) {
            if (!el || !previous || previous === 0) { if(el) el.style.display='none'; return; }
            const pct = ((current - previous) / previous * 100).toFixed(0);
            const isUp = current >= previous;
            el.className = 'kpi-trend ' + (isUp ? 'up' : 'down');
            el.textContent = (isUp ? '‚Üë' : '‚Üì') + ' ' + Math.abs(pct) + '% vs vorige week';
            el.style.display = 'inline-flex';
        }

        // ============ PIPELINE RENDER ============
        function renderPipeline(byStatus) {
            const stages = [
                { key: 'open', label: 'Nieuw', color: '#6b7084' },
                { key: 'ready_for_picking', label: 'Klaar voor picking', color: '#2563eb' },
                { key: 'processing', label: 'Picking', color: '#7c3aed' },
                { key: 'packed', label: 'Ingepakt', color: '#ea580c' },
                { key: 'shipped', label: 'Verzonden', color: '#0891b2' },
                { key: 'completed', label: 'Afgerond', color: '#16a34a' }
            ];
            const total = stages.reduce((s, st) => s + (byStatus[st.key] || 0), 0) || 1;
            const container = document.getElementById('pipelineContainer');
            container.textContent = '';
            stages.forEach((st, i) => {
                const count = byStatus[st.key] || 0;
                const pct = Math.max(((count / total) * 100), count > 0 ? 8 : 4);
                const div = document.createElement('div');
                div.style.cssText = `flex:${pct};background:${st.color};border-radius:${i===0?'12px 0 0 12px':i===stages.length-1?'0 12px 12px 0':'0'};padding:16px 12px;text-align:center;color:white;min-width:60px;display:flex;flex-direction:column;justify-content:center;transition:flex 0.5s;`;
                const countDiv = document.createElement('div');
                countDiv.style.cssText = 'font-size:24px;font-weight:700;';
                countDiv.textContent = count;
                const labelDiv = document.createElement('div');
                labelDiv.style.cssText = 'font-size:11px;opacity:0.9;margin-top:2px;';
                labelDiv.textContent = st.label;
                div.appendChild(countDiv);
                div.appendChild(labelDiv);
                container.appendChild(div);
                if (i < stages.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.style.cssText = 'display:flex;align-items:center;color:#d2d2d7;font-size:16px;flex-shrink:0;';
                    arrow.textContent = '‚Ä∫';
                    container.appendChild(arrow);
                }
            });
        }

        // ============ TOP WEBSHOPS ============
        function renderTopWebshops(shops) {
            const list = document.getElementById('topWebshopsList');
            if (!shops || shops.length === 0) {
                list.textContent = '';
                const empty = document.createElement('div');
                empty.style.cssText = 'text-align:center;padding:20px;color:#999;';
                empty.textContent = 'Geen data';
                list.appendChild(empty);
                return;
            }
            list.textContent = '';
            const maxCount = shops[0].count || 1;
            shops.forEach((shop, i) => {
                const pct = (shop.count / maxCount * 100).toFixed(0);
                const medal = i === 0 ? '\u{1F947}' : i === 1 ? '\u{1F948}' : i === 2 ? '\u{1F949}' : (i+1)+'.';
                const div = document.createElement('div');
                div.style.cssText = 'display:flex;align-items:center;gap:12px;padding:10px 12px;background:var(--gray-light);border-radius:10px;';

                const medalSpan = document.createElement('span');
                medalSpan.style.cssText = 'font-size:18px;width:28px;text-align:center;';
                medalSpan.textContent = medal;

                const infoDiv = document.createElement('div');
                infoDiv.style.cssText = 'flex:1;min-width:0;';
                const nameDiv = document.createElement('div');
                nameDiv.style.cssText = 'font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';
                nameDiv.textContent = shop.name;
                const barOuter = document.createElement('div');
                barOuter.style.cssText = 'height:4px;background:#e8e8ed;border-radius:2px;margin-top:4px;';
                const barInner = document.createElement('div');
                barInner.style.cssText = 'height:100%;width:' + pct + '%;background:var(--blue);border-radius:2px;transition:width 0.5s;';
                barOuter.appendChild(barInner);
                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(barOuter);

                const countSpan = document.createElement('span');
                countSpan.style.cssText = 'font-size:18px;font-weight:700;color:var(--blue);';
                countSpan.textContent = shop.count;

                div.appendChild(medalSpan);
                div.appendChild(infoDiv);
                div.appendChild(countSpan);
                list.appendChild(div);
            });
        }

        // ============ DASHBOARD KPIs ============
        async function loadDashboard() {
            try {
                const res = await fetch(`${API_BASE}/api/dashboard`, { headers: API_HEADERS });
                if (!res.ok) throw new Error('Dashboard API error');
                const json = await res.json();
                const d = json.data;

                // Orders deze week
                const kpiWeek = document.getElementById('kpiOrdersWeek');
                if (kpiWeek && d.orders) kpiWeek.textContent = Number(d.orders.week).toLocaleString('nl-NL');

                // Orders vandaag
                const kpiToday = document.getElementById('kpiOrdersToday');
                if (kpiToday && d.orders) kpiToday.textContent = Number(d.orders.today).toLocaleString('nl-NL');

                // Verzendingen deze week
                const kpiShipWeek = document.getElementById('kpiShipmentsWeek');
                if (kpiShipWeek && d.shipments) kpiShipWeek.textContent = Number(d.shipments.week).toLocaleString('nl-NL');

                // Open orders (status open/processing)
                const kpiOpen = document.getElementById('kpiOpenOrders');
                if (kpiOpen && d.orders && d.orders.by_status) {
                    const bs = d.orders.by_status;
                    const openCount = (bs.open || 0) + (bs.processing || 0) + (bs.picked || 0) + (bs.packed || 0) + (bs.ready_for_picking || 0);
                    kpiOpen.textContent = openCount.toLocaleString('nl-NL');
                }

                // Processed orders (shipped + completed + delivered)
                const kpiProcessed = document.getElementById('kpiProcessedOrders');
                if (kpiProcessed && d.orders && d.orders.processed !== undefined) {
                    kpiProcessed.textContent = Number(d.orders.processed).toLocaleString('nl-NL');
                }

                // Feature 1: Revenue
                if (d.revenue) {
                    const rt = document.getElementById('kpiRevenueToday');
                    const rw = document.getElementById('kpiRevenueWeek');
                    if (rt) rt.textContent = formatEuro(d.revenue.today);
                    if (rw) rw.textContent = formatEuro(d.revenue.week);
                }

                // Feature 2: Processing time
                if (d.avg_processing_time !== undefined) {
                    const pt = document.getElementById('kpiProcessingTime');
                    if (pt) pt.textContent = formatProcessingTime(d.avg_processing_time);
                }

                // Feature 3: Pipeline
                if (d.orders && d.orders.by_status) {
                    renderPipeline(d.orders.by_status);
                }

                // Feature 4: Problem orders
                if (d.problem_orders !== undefined && d.problem_orders > 0) {
                    const pa = document.getElementById('problemAlert');
                    const pc = document.getElementById('problemCount');
                    if (pa) pa.style.display = 'block';
                    if (pc) pc.textContent = d.problem_orders;
                } else {
                    const pa = document.getElementById('problemAlert');
                    if (pa) pa.style.display = 'none';
                }

                // Feature 5: Week-over-week trends
                if (d.prev_week) {
                    renderWeekTrend(document.getElementById('kpiOrdersWeekTrend'), d.orders.week, d.prev_week.orders);
                    renderWeekTrend(document.getElementById('kpiShipWeekTrend'), d.shipments.week, d.prev_week.shipments);
                }

                // Feature 6: Top webshops
                if (d.top_webshops) {
                    renderTopWebshops(d.top_webshops);
                }

                // Update subtitle met week + datum
                const headerP = document.querySelector('.header-title p');
                if (headerP) {
                    const now = new Date();
                    const weekNr = getWeekNumber(now);
                    headerP.textContent = `Week ${weekNr}, ${now.getFullYear()} ‚Äî Live data uit Goedgepickt`;
                }

                // Update chart met orders per dag
                if (d.orders_per_day) {
                    updateOrdersChart(d.orders_per_day);
                }

                // Update AI briefing met echte data
                updateAIBriefing(d);

                // Feature 7: Update refresh indicator
                updateRefreshIndicator();
            } catch (e) {
                console.log('Dashboard API niet beschikbaar:', e.message);
            }
        }

        // ============ AUTO-REFRESH (Feature 7) ============
        function updateRefreshIndicator() {
            const now = new Date();
            const timeStr = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
            const el = document.getElementById('lastUpdateTime');
            if (el) el.textContent = timeStr;
            // Flash
            const flash = document.getElementById('refreshFlash');
            if (flash) {
                flash.style.opacity = '1';
                setTimeout(() => flash.style.opacity = '0', 2000);
            }
        }

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function updateAIBriefing(d) {
            const title = document.querySelector('.ai-briefing-title');
            const text = document.querySelector('.ai-briefing-text');
            if (!title || !text || !d.orders) return;

            const now = new Date();
            const hour = now.getHours();
            const greeting = hour < 12 ? 'Goedemorgen' : hour < 18 ? 'Goedemiddag' : 'Goedenavond';
            title.textContent = greeting + '! Hier is uw live samenvatting.';

            const todayCount = d.orders.today || 0;
            const weekCount = d.orders.week || 0;
            const shipWeek = d.shipments ? d.shipments.week : 0;

            text.textContent = '';
            text.appendChild(document.createTextNode('Vandaag zijn er '));
            const s1 = document.createElement('strong');
            s1.textContent = todayCount + ' orders';
            text.appendChild(s1);
            text.appendChild(document.createTextNode(' binnengekomen. Deze week in totaal '));
            const s2 = document.createElement('strong');
            s2.textContent = weekCount + ' orders';
            text.appendChild(s2);
            text.appendChild(document.createTextNode(' en '));
            const s3 = document.createElement('strong');
            s3.textContent = shipWeek + ' verzendingen';
            text.appendChild(s3);
            text.appendChild(document.createTextNode('. Data wordt elke minuut ververst vanuit Goedgepickt.'));
        }

        // ============ ORDERS CHART (live data) ============
        let ordersChartInstance = null;

        function initChart() {
            const ctx = document.getElementById('ordersChart').getContext('2d');
            const gradient = ctx.createLinearGradient(0, 0, 0, 280);
            gradient.addColorStop(0, 'rgba(0, 113, 227, 0.15)');
            gradient.addColorStop(1, 'rgba(0, 113, 227, 0)');

            ordersChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['‚Äî', '‚Äî', '‚Äî', '‚Äî', '‚Äî', '‚Äî', '‚Äî'],
                    datasets: [{
                        label: 'Orders',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#0071e3',
                        backgroundColor: gradient,
                        borderWidth: 2.5,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#0071e3',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1d1d1f',
                            titleColor: '#fff',
                            bodyColor: 'rgba(255, 255, 255, 0.8)',
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' orders';
                                }
                            }
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#86868b', font: { size: 12 } } },
                        y: { grid: { color: 'rgba(0, 0, 0, 0.04)', drawBorder: false }, ticks: { color: '#86868b', font: { size: 12 } }, beginAtZero: true }
                    }
                }
            });
        }

        function updateOrdersChart(ordersPerDay) {
            if (!ordersChartInstance || !ordersPerDay) return;
            const dagNamen = ['zo', 'ma', 'di', 'wo', 'do', 'vr', 'za'];
            const sortedDates = Object.keys(ordersPerDay).sort();

            const labels = [];
            const values = [];

            for (let i = 0; i < sortedDates.length; i++) {
                const date = new Date(sortedDates[i] + 'T00:00:00');
                const dagNaam = dagNamen[date.getDay()];
                const dagNum = date.getDate();
                labels.push(`${dagNaam.charAt(0).toUpperCase() + dagNaam.slice(1)} ${dagNum}`);
                values.push(ordersPerDay[sortedDates[i]] || 0);
            }

            ordersChartInstance.data.labels = labels;
            ordersChartInstance.data.datasets[0].data = values;
            ordersChartInstance.update();
        }

        // ============ RECENT ORDERS ============
        function renderOrderRow(order) {
            const displayId = order.orderId || order.externalDisplayId || order.uuid.slice(0, 8);
            const customer = [order.billingFirstName, order.billingLastName].filter(Boolean).join(' ') || order.webshopName || '\u2014';
            const itemCount = (order.products && order.products.length) || 0;
            const statusLabel = STATUS_MAP[order.status] || order.status || '\u2014';
            const statusClass = STATUS_CLASS_MAP[order.status] || 'pending';
            const carrier = extractCarrier(order);

            const tr = document.createElement('tr');

            const tdId = document.createElement('td');
            const idSpan = document.createElement('span');
            idSpan.className = 'order-id';
            idSpan.textContent = displayId;
            tdId.appendChild(idSpan);

            const tdCustomer = document.createElement('td');
            tdCustomer.textContent = customer;

            const tdItems = document.createElement('td');
            tdItems.textContent = itemCount + ' item' + (itemCount !== 1 ? 's' : '');

            const tdStatus = document.createElement('td');
            const badge = document.createElement('span');
            badge.className = 'status-badge ' + statusClass;
            const dot = document.createElement('span');
            dot.className = 'status-dot';
            badge.appendChild(dot);
            badge.appendChild(document.createTextNode(statusLabel));
            tdStatus.appendChild(badge);

            const tdCarrier = document.createElement('td');
            tdCarrier.textContent = carrier;

            tr.appendChild(tdId);
            tr.appendChild(tdCustomer);
            tr.appendChild(tdItems);
            tr.appendChild(tdStatus);
            tr.appendChild(tdCarrier);
            return tr;
        }

        function showEmptyOrdersRow(tbody) {
            tbody.textContent = '';
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = 5;
            td.style.cssText = 'text-align:center;padding:30px;color:#999;';
            td.textContent = 'Geen recente orders';
            tr.appendChild(td);
            tbody.appendChild(tr);
        }

        async function loadRecentOrders() {
            try {
                const res = await fetch(`${API_BASE}/api/orders/latest?limit=5`, { headers: API_HEADERS });
                if (!res.ok) throw new Error('Orders API error');
                const json = await res.json();
                const orders = json.data || [];
                const tbody = document.getElementById('recentOrdersBody');
                if (!Array.isArray(orders) || orders.length === 0) {
                    showEmptyOrdersRow(tbody);
                    return;
                }

                tbody.textContent = '';
                orders.forEach(order => {
                    tbody.appendChild(renderOrderRow(order));
                });

                const subtitle = document.querySelector('.content-grid:last-of-type .card:first-child .card-subtitle');
                if (subtitle) subtitle.textContent = 'Laatste ' + orders.length + ' orders (live)';
            } catch (e) {
                console.log('Orders API niet beschikbaar:', e.message);
            }
        }

        // ============ CARRIER PERFORMANCE (live) ============
        async function loadCarrierPerformance() {
            try {
                const res = await fetch(`${API_BASE}/api/shipments/latest?limit=50`, { headers: API_HEADERS });
                if (!res.ok) throw new Error('Shipments API error');
                const json = await res.json();
                const shipments = json.data || [];
                if (!Array.isArray(shipments) || shipments.length === 0) return;

                // Tel per carrier
                const carriers = {};
                shipments.forEach(s => {
                    const name = extractCarrier(s);
                    if (!carriers[name]) carriers[name] = 0;
                    carriers[name]++;
                });

                const total = shipments.length;
                const sorted = Object.entries(carriers).sort((a, b) => b[1] - a[1]);

                const carrierList = document.getElementById('carrierList');
                carrierList.textContent = '';

                sorted.forEach(([name, count]) => {
                    const pct = ((count / total) * 100).toFixed(1);
                    const div = document.createElement('div');
                    div.className = 'carrier-item';

                    const logo = document.createElement('div');
                    logo.className = 'carrier-logo';
                    logo.textContent = name.substring(0, 5);

                    const info = document.createElement('div');
                    info.className = 'carrier-info';
                    const cName = document.createElement('div');
                    cName.className = 'carrier-name';
                    cName.textContent = name;
                    const cStats = document.createElement('div');
                    cStats.className = 'carrier-stats';
                    cStats.textContent = count + ' zendingen';
                    info.appendChild(cName);
                    info.appendChild(cStats);

                    const bar = document.createElement('div');
                    bar.className = 'carrier-bar';
                    const barFill = document.createElement('div');
                    barFill.className = 'carrier-bar-fill';
                    barFill.style.width = pct + '%';
                    bar.appendChild(barFill);

                    const percent = document.createElement('div');
                    percent.className = 'carrier-percent';
                    percent.textContent = pct + '%';

                    div.appendChild(logo);
                    div.appendChild(info);
                    div.appendChild(bar);
                    div.appendChild(percent);
                    carrierList.appendChild(div);
                });

                // Show disclaimer about sample size
                const disclaimer = document.getElementById('carrierDisclaimer');
                if (disclaimer) {
                    disclaimer.style.display = 'block';
                    disclaimer.textContent = '\u26A0\uFE0F Gebaseerd op de laatste ' + total + ' verzendingen. Voor een volledig beeld, bekijk de Verzendingen pagina.';
                }
            } catch (e) {
                console.log('Carrier data niet beschikbaar:', e.message);
                const cl = document.getElementById('carrierList');
                cl.textContent = '';
                const empty = document.createElement('div');
                empty.style.cssText = 'text-align:center;padding:20px;color:#999;';
                empty.textContent = 'Geen data beschikbaar';
                cl.appendChild(empty);
            }
        }

        // ============ INVENTORY ALERTS (live) ============
        function createAlertItem(alertData) {
            const stock = alertData.stock || alertData.stockLevel || 0;
            const isCritical = stock <= 10;
            const level = isCritical ? 'critical' : 'warning';
            const titleText = isCritical ? 'Kritiek laag' : 'Onder bestelpunt';
            const sku = alertData.sku || alertData.productSku || alertData.name || '\u2014';
            const svgPath = isCritical
                ? 'M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z'
                : 'M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z';

            const div = document.createElement('div');
            div.className = 'alert-item ' + level;

            const iconDiv = document.createElement('div');
            iconDiv.className = 'alert-icon';
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('fill', 'none');
            svg.setAttribute('viewBox', '0 0 24 24');
            svg.setAttribute('stroke-width', '1.5');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('stroke-linecap', 'round');
            path.setAttribute('stroke-linejoin', 'round');
            path.setAttribute('d', svgPath);
            svg.appendChild(path);
            iconDiv.appendChild(svg);

            const content = document.createElement('div');
            content.className = 'alert-content';
            const tDiv = document.createElement('div');
            tDiv.className = 'alert-title';
            tDiv.textContent = titleText;
            const sDiv = document.createElement('div');
            sDiv.className = 'alert-subtitle';
            sDiv.textContent = sku;
            content.appendChild(tDiv);
            content.appendChild(sDiv);

            const countDiv = document.createElement('div');
            countDiv.className = 'alert-count';
            countDiv.textContent = stock;

            div.appendChild(iconDiv);
            div.appendChild(content);
            div.appendChild(countDiv);
            return div;
        }

        function showEmptyAlerts(alertsList) {
            alertsList.textContent = '';
            const empty = document.createElement('div');
            empty.style.cssText = 'padding:20px;text-align:center;color:#16a34a;font-weight:500;';
            empty.textContent = '\u2713 Geen voorraad alerts';
            alertsList.appendChild(empty);
        }

        async function loadInventoryAlerts() {
            try {
                const res = await fetch(`${API_BASE}/api/inventory/alerts`, { headers: API_HEADERS });
                if (!res.ok) throw new Error('Alerts API error');
                const json = await res.json();
                const alerts = json.data || [];

                // Update KPI card
                const kpiLowStock = document.getElementById('kpiLowStock');
                if (kpiLowStock) kpiLowStock.textContent = json.count || alerts.length || 0;

                const alertsList = document.getElementById('alertsList');
                if (!Array.isArray(alerts) || alerts.length === 0) {
                    showEmptyAlerts(alertsList);
                    return;
                }

                alertsList.textContent = '';
                alerts.slice(0, 5).forEach(alert => {
                    alertsList.appendChild(createAlertItem(alert));
                });
            } catch (e) {
                console.log('Inventory alerts niet beschikbaar:', e.message);
                const al = document.getElementById('alertsList');
                al.textContent = '';
                const empty = document.createElement('div');
                empty.style.cssText = 'text-align:center;padding:20px;color:#999;';
                empty.textContent = 'Geen data beschikbaar';
                al.appendChild(empty);
            }
        }

        // ============ FAST COMBINED LOAD ============
        async function loadAll() {
            try {
                const res = await fetch(`${API_BASE}/api/page-data/dashboard`, { headers: API_HEADERS });
                if (!res.ok) throw new Error('Page data error');
                const json = await res.json();
                const d = json.data;

                // Dashboard stats (same as loadDashboard)
                if (d.dashboard) {
                    const stats = d.dashboard;
                    const kpiWeek = document.getElementById('kpiOrdersWeek');
                    if (kpiWeek && stats.orders) {
                        kpiWeek.textContent = Number(stats.orders.week).toLocaleString('nl-NL');
                    }
                    const kpiToday = document.getElementById('kpiOrdersToday');
                    if (kpiToday && stats.orders) kpiToday.textContent = Number(stats.orders.today).toLocaleString('nl-NL');

                    const kpiShipWeek = document.getElementById('kpiShipmentsWeek');
                    if (kpiShipWeek && stats.shipments) kpiShipWeek.textContent = Number(stats.shipments.week).toLocaleString('nl-NL');

                    // Open orders
                    const kpiOpen = document.getElementById('kpiOpenOrders');
                    if (kpiOpen && stats.orders && stats.orders.by_status) {
                        const bs = stats.orders.by_status;
                        const openCount = (bs.open || 0) + (bs.processing || 0) + (bs.picked || 0) + (bs.packed || 0) + (bs.ready_for_picking || 0);
                        kpiOpen.textContent = openCount.toLocaleString('nl-NL');
                    }

                    // Processed orders (shipped + completed + delivered)
                    const kpiProcessed = document.getElementById('kpiProcessedOrders');
                    if (kpiProcessed && stats.orders && stats.orders.processed !== undefined) {
                        kpiProcessed.textContent = Number(stats.orders.processed).toLocaleString('nl-NL');
                    }

                    // Revenue
                    if (stats.revenue) {
                        const rt = document.getElementById('kpiRevenueToday');
                        const rw = document.getElementById('kpiRevenueWeek');
                        if (rt) rt.textContent = formatEuro(stats.revenue.today);
                        if (rw) rw.textContent = formatEuro(stats.revenue.week);
                    }

                    // Processing time
                    if (stats.avg_processing_time !== undefined) {
                        const pt = document.getElementById('kpiProcessingTime');
                        if (pt) pt.textContent = formatProcessingTime(stats.avg_processing_time);
                    }

                    // Pipeline
                    if (stats.orders && stats.orders.by_status) {
                        renderPipeline(stats.orders.by_status);
                    }

                    // Problem orders
                    if (stats.problem_orders !== undefined && stats.problem_orders > 0) {
                        const pa = document.getElementById('problemAlert');
                        const pc = document.getElementById('problemCount');
                        if (pa) pa.style.display = 'block';
                        if (pc) pc.textContent = stats.problem_orders;
                    } else {
                        const pa = document.getElementById('problemAlert');
                        if (pa) pa.style.display = 'none';
                    }

                    // Week-over-week
                    if (stats.prev_week) {
                        renderWeekTrend(document.getElementById('kpiOrdersWeekTrend'), stats.orders.week, stats.prev_week.orders);
                        renderWeekTrend(document.getElementById('kpiShipWeekTrend'), stats.shipments.week, stats.prev_week.shipments);
                    }

                    // Top webshops
                    if (stats.top_webshops) {
                        renderTopWebshops(stats.top_webshops);
                    }

                    if (stats.orders_per_day) updateOrdersChart(stats.orders_per_day);
                    updateAIBriefing(stats);
                }

                // Update refresh indicator
                updateRefreshIndicator();

                // Recent orders
                if (d.recentOrders && d.recentOrders.length > 0) {
                    const orders = d.recentOrders;
                    const tbody = document.getElementById('recentOrdersBody');
                    if (tbody) {
                        tbody.textContent = '';
                        orders.forEach(order => {
                            tbody.appendChild(renderOrderRow(order));
                        });
                        const subtitle = document.querySelector('.content-grid:last-of-type .card:first-child .card-subtitle');
                        if (subtitle) subtitle.textContent = 'Laatste ' + orders.length + ' orders (live)';
                    }
                }

                // Inventory alerts
                if (d.inventoryAlerts) {
                    const alerts = d.inventoryAlerts;
                    const kpiLowStock = document.getElementById('kpiLowStock');
                    if (kpiLowStock) kpiLowStock.textContent = alerts.length || 0;
                    const alertsList = document.getElementById('alertsList');
                    if (alertsList) {
                        if (alerts.length === 0) {
                            showEmptyAlerts(alertsList);
                        } else {
                            alertsList.textContent = '';
                            alerts.slice(0, 5).forEach(alert => {
                                alertsList.appendChild(createAlertItem(alert));
                            });
                        }
                    }
                }
            } catch (e) {
                console.log('Combined load failed, falling back to individual calls:', e.message);
                loadDashboard();
                loadRecentOrders();
                loadInventoryAlerts();
            }
            // Carrier perf altijd apart (niet in combined endpoint)
            loadCarrierPerformance();
        }

        // ============ SLA METRICS ============
        var currentSLAPeriod = 'today';

        function renderSLATrend(el, trend, currentVal, prevVal) {
            if (!el || !trend) return;
            if (trend === 'stable') {
                el.style.display = 'none';
                return;
            }
            el.style.display = '';
            var isUp = trend === 'up';
            el.className = 'kpi-trend ' + (isUp ? 'up' : 'down');
            var arrow = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            arrow.setAttribute('fill', 'none');
            arrow.setAttribute('viewBox', '0 0 24 24');
            arrow.setAttribute('stroke-width', '2');
            arrow.setAttribute('stroke', 'currentColor');
            var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('stroke-linecap', 'round');
            path.setAttribute('stroke-linejoin', 'round');
            path.setAttribute('d', isUp ? 'M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25' : 'M4.5 4.5l15 15m0 0V8.25m0 11.25H8.25');
            arrow.appendChild(path);
            el.textContent = '';
            el.appendChild(arrow);
            if (prevVal !== undefined && prevVal !== null) {
                var diff = document.createTextNode(' ' + Number(prevVal).toFixed(1) + '%');
                el.appendChild(diff);
            }
        }

        async function loadSLAMetrics(period) {
            period = period || currentSLAPeriod;
            try {
                var res = await fetch(API_BASE + '/api/metrics/sla?period=' + period, { headers: API_HEADERS });
                if (!res.ok) return;
                var json = await res.json();
                var d = json.data && json.data.metrics ? json.data.metrics : {};

                // On-Time Shipping
                var otEl = document.getElementById('slaOnTime');
                if (otEl && d.on_time_shipping) {
                    otEl.textContent = Number(d.on_time_shipping.percentage).toFixed(1) + '%';
                    renderSLATrend(
                        document.getElementById('slaOnTimeTrend'),
                        d.on_time_shipping.trend,
                        d.on_time_shipping.percentage,
                        d.on_time_shipping.prev_percentage
                    );
                }

                // Order Accuracy
                var accEl = document.getElementById('slaAccuracy');
                if (accEl && d.order_accuracy) {
                    accEl.textContent = Number(d.order_accuracy.percentage).toFixed(1) + '%';
                    renderSLATrend(
                        document.getElementById('slaAccuracyTrend'),
                        d.order_accuracy.trend,
                        d.order_accuracy.percentage,
                        d.order_accuracy.prev_percentage
                    );
                }

                // Cycle Time
                var ctEl = document.getElementById('slaCycleTime');
                if (ctEl && d.order_cycle_time) {
                    var mins = Number(d.order_cycle_time.avg_minutes);
                    if (mins >= 60) {
                        ctEl.textContent = (mins / 60).toFixed(1) + 'u';
                    } else {
                        ctEl.textContent = Math.round(mins) + 'min';
                    }
                    // For cycle time, "down" is good (faster), "up" is bad (slower)
                    var ctTrend = d.order_cycle_time.trend;
                    var ctTrendEl = document.getElementById('slaCycleTrend');
                    if (ctTrendEl && ctTrend && ctTrend !== 'stable') {
                        ctTrendEl.style.display = '';
                        var ctIsGood = ctTrend === 'down';
                        ctTrendEl.className = 'kpi-trend ' + (ctIsGood ? 'up' : 'down');
                        var ctArrow = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        ctArrow.setAttribute('fill', 'none');
                        ctArrow.setAttribute('viewBox', '0 0 24 24');
                        ctArrow.setAttribute('stroke-width', '2');
                        ctArrow.setAttribute('stroke', 'currentColor');
                        var ctPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        ctPath.setAttribute('stroke-linecap', 'round');
                        ctPath.setAttribute('stroke-linejoin', 'round');
                        ctPath.setAttribute('d', ctTrend === 'down' ? 'M4.5 4.5l15 15m0 0V8.25m0 11.25H8.25' : 'M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25');
                        ctArrow.appendChild(ctPath);
                        ctTrendEl.textContent = '';
                        ctTrendEl.appendChild(ctArrow);
                        if (d.order_cycle_time.prev_avg_minutes !== undefined) {
                            var prevMins = Number(d.order_cycle_time.prev_avg_minutes);
                            var prevText = prevMins >= 60 ? (prevMins / 60).toFixed(1) + 'u' : Math.round(prevMins) + 'min';
                            ctTrendEl.appendChild(document.createTextNode(' ' + prevText));
                        }
                    } else if (ctTrendEl) {
                        ctTrendEl.style.display = 'none';
                    }
                }

                // Perfect Order Rate
                var prEl = document.getElementById('slaPerfect');
                if (prEl && d.perfect_order_rate) {
                    prEl.textContent = Number(d.perfect_order_rate.percentage).toFixed(1) + '%';
                    renderSLATrend(
                        document.getElementById('slaPerfectTrend'),
                        d.perfect_order_rate.trend,
                        d.perfect_order_rate.percentage,
                        d.perfect_order_rate.prev_percentage
                    );
                }

                // Status indicator
                var slaStatus = document.getElementById('slaStatus');
                if (slaStatus) {
                    var periodLabel = period === 'today' ? 'vandaag' : period === 'week' ? 'deze week' : 'deze maand';
                    slaStatus.textContent = 'Live ‚Äî ' + periodLabel;
                }
            } catch (e) {
                console.log('SLA metrics niet beschikbaar:', e.message);
            }
        }

        // SLA period selector
        document.getElementById('slaPeriodBtns').addEventListener('click', function(e) {
            var btn = e.target.closest('.sla-period-btn');
            if (!btn) return;
            var period = btn.getAttribute('data-period');
            if (period === currentSLAPeriod) return;
            currentSLAPeriod = period;
            var btns = document.querySelectorAll('.sla-period-btn');
            btns.forEach(function(b) {
                b.style.background = 'white';
                b.style.color = 'var(--gray-dark)';
                b.classList.remove('active');
            });
            btn.style.background = 'var(--blue)';
            btn.style.color = 'white';
            btn.classList.add('active');
            loadSLAMetrics(period);
        });

        // ============ INIT ============
        initChart();
        loadAll();
        loadSLAMetrics();

        // Feature 7: Auto-refresh elke 60 seconden (GEEN page reload)
        setInterval(() => {
            loadAll();
            loadSLAMetrics();
        }, 60000);
    </script>
<script src="nav.js"></script>
<script src="ai-insights.js"></script>
</body>
</html>
